---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

To get the Rsquare I followed the formula that I found on: https://journals.plos.org/plosone/article/file?type=supplementary&id=info:doi/10.1371/journal.pone.0120758.s001 which is basically the same used by Gharahkhani,2019 (BMI&cancer):
2(β^2)MAF(1 − MAF)/ 2(β^2)MAF(1 − MAF) + (se(β))^2*2NMAF(1 − MAF)

```{r}
r2function <- function(x) {
  Rsq <- (2*(x[2]^2)*x[1]*(1-x[1]))/((2*(x[2]^2)*x[1]*(1-x[1]))+((x[3]^2)*2*x[4]*x[1]*(1-x[1])))
  result<- paste(result,Rsq)
  return(result)
}
```
```{r}
library(dplyr)
pathData<-c("/data/neurogen/MRandPD/Results/R2andFstat4IndexSNPs/smoking4R2calc/")
smokingNames<-list.files(path = pathData, pattern = NULL)
smokingforR2calc <- lapply(paste(pathData,smokingNames,sep = "" ), read.table, skip=1)
smokingRsquare <- vector()
for(j in 1:length(smokingNames)){
  result<- vector()
  RsqIV<- apply(smokingforR2calc[[j]][,c(6,9,10,11)],1,r2function)
  Rsquare<- sum(as.numeric(RsqIV))  
  smokingRsquare<-append(smokingRsquare,Rsquare)
}
smokingNames <- sub("forR2calc","", smokingNames)
smokingNames
smokingRsquare
```
```{r}
pathData<-c("/data/neurogen/MRandPD/Results/R2andFstat4IndexSNPs/sleeping4R2calc/")
sleepingNames<-list.files(path = pathData, pattern = NULL)
sleepingforR2calc <- lapply(paste(pathData,sleepingNames,sep = "" ), read.table, skip=1)
sleepingRsquare <- vector()
for(j in 1:length(sleepingNames)){
  result<- vector()
  RsqIV<- apply(sleepingforR2calc[[j]][,c(6,7,8,10)],1,r2function)
  Rsquare<- sum(as.numeric(RsqIV))  
  sleepingRsquare<-append(sleepingRsquare,Rsquare)
}
sleepingNames <- sub("forR2calc","", sleepingNames)
sleepingNames
sleepingRsquare
```
```{r}
pathData<-c("/data/neurogen/MRandPD/Results/R2andFstat4IndexSNPs/AfterNallsR2calc/")
AfterNallsNames<-list.files(path = pathData, pattern = NULL)
AfterNallsforR2calc <- lapply(paste(pathData,AfterNallsNames,sep = "" ), read.table, skip=1)
AfterNallsRsquare <- vector()
for(j in 1:length(AfterNallsNames)){
  result<- vector()
  RsqIV<- apply(AfterNallsforR2calc[[j]][,c(6,7,8,10)],1,r2function)
  Rsquare<- sum(as.numeric(RsqIV))  
  AfterNallsRsquare<-append(AfterNallsRsquare,Rsquare)
}
AfterNallsNames <- sub("forR2calcVNalls","", AfterNallsNames)
AfterNallsNames
AfterNallsRsquare
```

To calculate the F-statistic I followed the formula on Noyce,2017 (MBI&Parkinson). Rsquare(n-1-k)/(1-Rsquare)k
where n--> samble size and k--> number of variants
(According to Gharahkhani,2019 (BMI&cancer), "the genetic variants used as the instrumental variable must be strongly associated with the risk factor of interest (F-statistics > 10)".)
```{r}
datanames<- c(smokingNames,AfterNallsNames)
AllRsquare<- c(smokingRsquare,AfterNallsRsquare)
AllRsquare<-data.frame(AllRsquare, row.names=datanames)
SampleSize<-c(262990,257341,537349,632802,312821,293723,111645,58702,111974)
NumberofVariants<-c(nrow(smokingforR2calc[[1]]),nrow(smokingforR2calc[[2]]),nrow(smokingforR2calc[[3]]),nrow(smokingforR2calc[[4]]),nrow(smokingforR2calc[[5]]),nrow(AfterNallsforR2calc[[1]]),nrow(AfterNallsforR2calc[[2]]),nrow(AfterNallsforR2calc[[3]]),nrow(AfterNallsforR2calc[[4]]))
SumDataPhenotypes<- cbind(AllRsquare,SampleSize,NumberofVariants)
PercentaceVarExplained <- apply(AllRsquare,1,function(x) x*100)
Fstatistic <- apply(SumDataPhenotypes,1,function(x) (x[1]*(x[2]-1-x[3]))/((1-x[1])*x[3]))
SumDataPhenotypes<- cbind(SumDataPhenotypes,Fstatistic,PercentaceVarExplained)
write.table(SumDataPhenotypes, "/data/neurogen/MRandPD/Results/R2andFstat4IndexSNPs/RsqFstatwNalls.txt",sep="\t", quote = FALSE)
```
