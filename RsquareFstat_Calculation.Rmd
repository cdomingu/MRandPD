---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

To get the Rsquare I followed the formula that I found on: https://journals.plos.org/plosone/article/file?type=supplementary&id=info:doi/10.1371/journal.pone.0120758.s001 which is basically the same used by Gharahkhani,2019 (BMI&cancer):
2(β^2)MAF(1 − MAF)/ 2(β^2)MAF(1 − MAF) + (se(β))^2*2NMAF(1 − MAF)

Fist I did this for all the instrumental variables found over each trait

do: setwd("/data/neurogen/MRandPD/Results/R2andFstatisticprePD")

```{r}
smokingcolnames<- c("CHROM","POS","RSID","REF","ALT","AF","STAT","PVALUE","BETA","SE","N","EFFECTIVE_N","Number_of_Studies","ANNO","ANNOFULL")
ageofinitiationsmkall<- read.table("ageofinitiationforR2calc", skip = 1, col.names = smokingcolnames)
ageofinitiationsmkall<-tbl_df(ageofinitiationsmkall)
varexpageinitsmk<-apply(ageofinitiationsmkall[,c(6,9,10,11)],1,function(x) (2*(x[2]^2)*x[1]*(1-x[1]))/((2*(x[2]^2)*x[1]*(1-x[1]))+((x[3]^2)*2*x[4]*x[1]*(1-x[1]))))
percvarexpageinitsmk<-sum(varexpageinitsmk)

cigperdaysmkall<- read.table("cigarettespdayforR2calc", skip = 1, col.names = smokingcolnames)
cigperdaysmkall<-tbl_df(cigperdaysmkall)
varexpcigperdaysmk<-apply(cigperdaysmkall[,c(6,9,10,11)],1,function(x) (2*(x[2]^2)*x[1]*(1-x[1]))/((2*(x[2]^2)*x[1]*(1-x[1]))+((x[3]^2)*2*x[4]*x[1]*(1-x[1]))))
percvarexpcigperday<-sum(varexpcigperdaysmk)

eversmkall<- read.table("eversmokingforR2calc", skip = 1, col.names = smokingcolnames)
eversmkall<-tbl_df(eversmkall)
varexpeversmk<-apply(eversmkall[,c(6,9,10,11)],1,function(x) (2*(x[2]^2)*x[1]*(1-x[1]))/((2*(x[2]^2)*x[1]*(1-x[1]))+((x[3]^2)*2*x[4]*x[1]*(1-x[1]))))
percvarexpeversmk<-sum(varexpeversmk)

smokestat<- read.table("smokingstatusforR2calc", skip = 1, col.names = smokingcolnames)
smokestat<-tbl_df(smokestat)
varexpsmokstat<-apply(smokestat[,c(6,9,10,11)],1,function(x) (2*(x[2]^2)*x[1]*(1-x[1]))/((2*(x[2]^2)*x[1]*(1-x[1]))+((x[3]^2)*2*x[4]*x[1]*(1-x[1]))))
percvarexpsmokstat<-sum(varexpsmokstat)
```

```{r}
drinksperweek<- read.table("drinksperweekforR2calc", skip = 1, col.names = smokingcolnames)
drinksperweek<-tbl_df(drinksperweek)
varexpdrinksperweek<-apply(drinksperweek[,c(6,9,10,12)],1,function(x) (2*(x[2]^2)*x[1]*(1-x[1]))/((2*(x[2]^2)*x[1]*(1-x[1]))+((x[3]^2)*2*x[4]*x[1]*(1-x[1]))))
percvarexpdrinksperweek<-sum(varexpdrinksperweek)
```

```{r}
sleepcolnames <- c("SNP","CHR","BP","A1","A2","MAF","BETA","SE","P","N")
insomnia<- read.table("insomniaforR2calc", skip = 1, col.names = sleepcolnames)
insomnia<-tbl_df(insomnia)
varexpinsomn<-apply(insomnia[,c(6,7,8,10)],1,function(x) (2*(x[2]^2)*x[1]*(1-x[1]))/((2*(x[2]^2)*x[1]*(1-x[1]))+((x[3]^2)*2*x[4]*x[1]*(1-x[1]))))
percvarexpinsomn<-sum(varexpinsomn)

sleepdur<- read.table("sleepdurforR2calc", skip = 1, col.names = sleepcolnames)
sleepdur<-tbl_df(sleepdur)
varexpsleepdur<-apply(sleepdur[,c(6,7,8,10)],1,function(x) (2*(x[2]^2)*x[1]*(1-x[1]))/((2*(x[2]^2)*x[1]*(1-x[1]))+((x[3]^2)*2*x[4]*x[1]*(1-x[1]))))
percvarexpsleepdur<-sum(varexpsleepdur)

excessdaysleep<- read.table("excessdaysleepforR2calc", skip = 1, col.names = sleepcolnames)
excessdaysleep<-tbl_df(excessdaysleep)
varexpexcessdaysleep<-apply(excessdaysleep[,c(6,7,8,10)],1,function(x) (2*(x[2]^2)*x[1]*(1-x[1]))/((2*(x[2]^2)*x[1]*(1-x[1]))+((x[3]^2)*2*x[4]*x[1]*(1-x[1]))))
percvarexpexcessdaysleep<-sum(varexpexcessdaysleep)
```

```{r}
N<-293723
educolnames<- c("MarkerName","CHR","POS","A1","A2","EAF","Beta","SE","Pval")
eduyears<- read.table("eduyearsforR2calc", skip = 1, col.names = educolnames)
eduyears<-tbl_df(eduyears)
varexpeduyears<-apply(eduyears[,c(6,7,8)],1,function(x) (2*(x[2]^2)*x[1]*(1-x[1]))/((2*(x[2]^2)*x[1]*(1-x[1]))+((x[3]^2)*2*N*x[1]*(1-x[1]))))
percvarexpeduyears<-sum(varexpeduyears)
```

To calculate the F-statistic I followed the formula on Noyce,2017 (MBI&Parkinson). Rsquare(n-1-k)/(1-Rsquare)k
where n--> samble size and k--> number of variants
(According to Gharahkhani,2019 (BMI&cancer), "the genetic variants used as the instrumental variable must be strongly associated with the risk factor of interest (F-statistics > 10)".)

```{r}
datanames<- c("smokeageinitiation","cigarettespday","eversmoking","smokingstatus","drinksperweek","insomnia","sleepduration","excessivedaysleep","eduyears")
Rsquare<- c(percvarexpageinitsmk,percvarexpcigperday,percvarexpeversmk,percvarexpsmokstat,percvarexpdrinksperweek,percvarexpinsomn,percvarexpsleepdur,percvarexpexcessdaysleep,percvarexpeduyears)
Rsquare<-data.frame(Rsquare, row.names = datanames)
SampleSize<-c(262990,257341,632802,312821,537349,58702,111974,111645,293723)
NumberofVariants<-c(nrow(ageofinitiationsmkall),nrow(cigperdaysmkall),nrow(eversmkall),nrow(smokestat),nrow(drinksperweek),nrow(insomnia),nrow(sleepdur),nrow(excessdaysleep),nrow(eduyears))
SumDataPhenotypes<- cbind(Rsquare,SampleSize,NumberofVariants)
PercentaceVarExplained <- apply(Rsquare,1,function(x) x*100)
Fstatistic <- apply(SumDataPhenotypes,1,function(x) (x[1]*(x[2]-1-x[3]))/((1-x[1])*x[3]))
SumDataPhenotypes<- cbind(Rsquare,SampleSize,NumberofVariants,Fstatistic,PercentaceVarExplained)
write.table(SumDataPhenotypes, "/data/neurogen/MRandPD/Results/R2andFstatisticprePD/RsqFstatprePD.txt", sep="\t")
```



Then I repeated this process but with the index SNPS that were also found on the PD GWAS dataset.

do: setwd("/data/neurogen/MRandPD/Results/R2andFstatisticVerbose")
```{r}
smokingcolnames<- c("CHROM","POS","RSID","REF","ALT","AF","STAT","PVALUE","BETA","SE","N","EFFECTIVE_N","Number_of_Studies","ANNO","ANNOFULL")
ageofinitiationsmkall<- read.table("ageofinitiationforR2calcV", skip = 1, col.names = smokingcolnames)
ageofinitiationsmkall<-tbl_df(ageofinitiationsmkall)
varexpageinitsmk<-apply(ageofinitiationsmkall[,c(6,9,10,11)],1,function(x) (2*(x[2]^2)*x[1]*(1-x[1]))/((2*(x[2]^2)*x[1]*(1-x[1]))+((x[3]^2)*2*x[4]*x[1]*(1-x[1]))))
percvarexpageinitsmk<-sum(varexpageinitsmk)

cigperdaysmkall<- read.table("cigarettespdayforR2calcV", skip = 1, col.names = smokingcolnames)
cigperdaysmkall<-tbl_df(cigperdaysmkall)
varexpcigperdaysmk<-apply(cigperdaysmkall[,c(6,9,10,11)],1,function(x) (2*(x[2]^2)*x[1]*(1-x[1]))/((2*(x[2]^2)*x[1]*(1-x[1]))+((x[3]^2)*2*x[4]*x[1]*(1-x[1]))))
percvarexpcigperday<-sum(varexpcigperdaysmk)

eversmkall<- read.table("eversmokingforR2calcV", skip = 1, col.names = smokingcolnames)
eversmkall<-tbl_df(eversmkall)
varexpeversmk<-apply(eversmkall[,c(6,9,10,11)],1,function(x) (2*(x[2]^2)*x[1]*(1-x[1]))/((2*(x[2]^2)*x[1]*(1-x[1]))+((x[3]^2)*2*x[4]*x[1]*(1-x[1]))))
percvarexpeversmk<-sum(varexpeversmk)

smokestat<- read.table("smokingstatusforR2calcV", skip = 1, col.names = smokingcolnames)
smokestat<-tbl_df(smokestat)
varexpsmokstat<-apply(smokestat[,c(6,9,10,11)],1,function(x) (2*(x[2]^2)*x[1]*(1-x[1]))/((2*(x[2]^2)*x[1]*(1-x[1]))+((x[3]^2)*2*x[4]*x[1]*(1-x[1]))))
percvarexpsmokstat<-sum(varexpsmokstat)
```

```{r}
drinksperweek<- read.table("drinksperweekforR2calcV", skip = 1, col.names = smokingcolnames)
drinksperweek<-tbl_df(drinksperweek)
varexpdrinksperweek<-apply(drinksperweek[,c(6,9,10,12)],1,function(x) (2*(x[2]^2)*x[1]*(1-x[1]))/((2*(x[2]^2)*x[1]*(1-x[1]))+((x[3]^2)*2*x[4]*x[1]*(1-x[1]))))
percvarexpdrinksperweek<-sum(varexpdrinksperweek)
```

```{r}
sleepcolnames <- c("SNP","CHR","BP","A1","A2","MAF","BETA","SE","P","N")
insomnia<- read.table("insomniaforR2calcV", skip = 1, col.names = sleepcolnames)
insomnia<-tbl_df(insomnia)
varexpinsomn<-apply(insomnia[,c(6,7,8,10)],1,function(x) (2*(x[2]^2)*x[1]*(1-x[1]))/((2*(x[2]^2)*x[1]*(1-x[1]))+((x[3]^2)*2*x[4]*x[1]*(1-x[1]))))
percvarexpinsomn<-sum(varexpinsomn)

sleepdur<- read.table("sleepdurforR2calcV", skip = 1, col.names = sleepcolnames)
sleepdur<-tbl_df(sleepdur)
varexpsleepdur<-apply(sleepdur[,c(6,7,8,10)],1,function(x) (2*(x[2]^2)*x[1]*(1-x[1]))/((2*(x[2]^2)*x[1]*(1-x[1]))+((x[3]^2)*2*x[4]*x[1]*(1-x[1]))))
percvarexpsleepdur<-sum(varexpsleepdur)

excessdaysleep<- read.table("excessdaysleepforR2calcV", skip = 1, col.names = sleepcolnames)
excessdaysleep<-tbl_df(excessdaysleep)
varexpexcessdaysleep<-apply(excessdaysleep[,c(6,7,8,10)],1,function(x) (2*(x[2]^2)*x[1]*(1-x[1]))/((2*(x[2]^2)*x[1]*(1-x[1]))+((x[3]^2)*2*x[4]*x[1]*(1-x[1]))))
percvarexpexcessdaysleep<-sum(varexpexcessdaysleep)
```

```{r}
N<-293723
educolnames<- c("MarkerName","CHR","POS","A1","A2","EAF","Beta","SE","Pval")
eduyears<- read.table("eduyearsforR2calcV", skip = 1, col.names = educolnames)
eduyears<-tbl_df(eduyears)
varexpeduyears<-apply(eduyears[,c(6,7,8)],1,function(x) (2*(x[2]^2)*x[1]*(1-x[1]))/((2*(x[2]^2)*x[1]*(1-x[1]))+((x[3]^2)*2*N*x[1]*(1-x[1]))))
percvarexpeduyears<-sum(varexpeduyears)
```

```{r}
datanames<- c("smokeageinitiation","cigarettespday","eversmoking","smokingstatus","drinksperweek","insomnia","sleepduration","excessivedaysleep","eduyears")
Rsquare<- c(percvarexpageinitsmk,percvarexpcigperday,percvarexpeversmk,percvarexpsmokstat,percvarexpdrinksperweek,percvarexpinsomn,percvarexpsleepdur,percvarexpexcessdaysleep,percvarexpeduyears)
Rsquare<-data.frame(Rsquare, row.names = datanames)
SampleSize<-c(262990,257341,632802,312821,537349,58702,111974,111645,293723)
NumberofVariants<-c(nrow(ageofinitiationsmkall),nrow(cigperdaysmkall),nrow(eversmkall),nrow(smokestat),nrow(drinksperweek),nrow(insomnia),nrow(sleepdur),nrow(excessdaysleep),nrow(eduyears))
SumDataPhenotypes<- cbind(Rsquare,SampleSize,NumberofVariants)
PercentaceVarExplained <- apply(Rsquare,1,function(x) x*100)
Fstatistic <- apply(SumDataPhenotypes,1,function(x) (x[1]*(x[2]-1-x[3]))/((1-x[1])*x[3]))
SumDataPhenotypes<- cbind(Rsquare,SampleSize,NumberofVariants,Fstatistic,PercentaceVarExplained)
write.table(SumDataPhenotypes, "/data/neurogen/MRandPD/Results/R2andFstatisticVerbose/RsqFstatvD.txt")
```


